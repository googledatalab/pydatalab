language: python
dist: trusty
sudo: required

matrix:
  include:
  - python: 2.7
    env: TOX_ENV=py27
  - python: 3.5
    env: TOX_ENV=py35
  - python: 2.7
    env: TOX_ENV=flake8
  - python: 2.7
    env: TOX_ENV=coveralls

before_install:
  - npm install -g typescript
  - tsc --module amd --noImplicitAny --outdir datalab/notebook/static datalab/notebook/static/*.ts
  # We use tox for actually running tests.
  - pip install --upgrade pip tox
  
install:
- if [ -n "${SERVICE_ACCOUNT_KEY}" ]; then
    echo "${SERVICE_ACCOUNT_KEY}" > ~/datalab-travis-build-bot.json;
  else
    openssl aes-256-cbc -K "$encrypted_a0ecf488aafb_key" -iv "$encrypted_a0ecf488aafb_iv"
      -in .build-bot.json -out ~/datalab-travis-build-bot.json -d;
  fi

env:
  - GOOGLE_APPLICATION_CREDENTIALS=~/datalab-travis-build-bot.json

script:
  # tox reads its configuration from tox.ini.
  - tox -e $TOX_ENV

